---
title: Процессы генерации показателей
---
## Генерация показателей при добавлении гранта в личном кабинете
### Предусловия
1. Сбор отчетности открыт для формирования комплектов отчетов
2. В системе сформированны отчеты по сбору для организации
3. Отчеты находятся в статусе черновик/На доработке
4. Группа генерации показателей настроена
5. В комплекте указана группа генерации показателей
### Схема процесса
```mermaid
sequenceDiagram
    actor US as Пользователь СХТП
    participant OP as Личный кабинет организации СХТП<br/>(ОШС)
    participant Topic1 as Топик<br/>События грантов
    participant IR as Сервис<br/>indicator-registry
    participant RR as reporting-reglaments
    participant Topic2 as Топик<br/>События измерений
    participant RI as Сервис<br/>reporting-instance
    participant Topic3 as Топик<br/>Необходимости генерации показателей
    autonumber
    US -)+ OP: Добаляет сведения о полученом гранте
    OP ->> OP: Сохранение сведений о гранте
    OP -)- Topic1: Отправляет событие о создании гранта
    Note over Topic1: Тип события<br/>Id гранта
    Topic1 -) IR: Прочитал событие о создании гранта
    IR ->>+ OP: Get сведения о гранте по id гранта
    OP -->> IR: Cведения о гранте
    Note left of IR: Какие-то сведения о гранте<br/>id respondent<br/>id recipient
    IR ->> IR: Создание значения измерения<br/>"Сведения о грантовой поддержке"
    IR ->> IR: Получить группы генерации показателей по виду измерения
    IR -) Topic2: Добавилось значение измерения
    Note left of Topic2: Push сообщение:<br/>id respondent<br/>id recipient<br/>список id групп генерации показателей
    Topic2 -) RI: Получение сообщения о добавленом измерении
    RI ->> RI: Определеяем подходящие ЭО по контексту сообщения
    Note over RI: ЭО должны быть в статусе<br/>Черновик/На доработке,<br/>отчетный период должен быть открыт<br/>в соответсвии с требования статусов
    alt "ЭО найдены"
        RI ->> RI: Переводим ЭО в состояние "На формировании"
        RI -) Topic3: Push сообщения о необходимости сгенерировать показатели
    end
```
